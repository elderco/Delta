@model VillaBisutti.Delta.Core.DTO.Prato
@{
	Layout = "~/Views/Shared/_ConfiguracoesLayout.cshtml";
}
<script language="javascript" type="text/javascript">
	function RemoverPrato(cardapioId, pratoId) {
		var url = '@Url.Action("RemoverPratoCardapio", "Prato", new { pratoId = "PrAtOiD", cardapioId = "CaRdApIoId" })';
		url = url.replace("CaRdApIoId", cardapioId).replace("PrAtOiD", pratoId).replace("&amp;", "&");
		AddStack(url);
	}
	function AvisarPratoExistente(cardapio, prato) {
		AddStack("O prato <em>" + prato + "</em> já está incluso no cardápio <em>" + cardapio + "</em><br/>Nada foi alterado", true)
	}
	function IncluirPrato(cardapioId, pratoId) {
		var url = '@Url.Action("IncluirPratoCardapio", "Prato", new { pratoId = "PrAtOiD", cardapioId = "CaRdApIoId" })';
		url = url.replace("CaRdApIoId", cardapioId).replace("PrAtOiD", pratoId).replace("&amp;", "&");
		alert(url);
		AddStack(url);
	}
	function SortItems(containerId) {
		containerId = "#" + containerId;
		var $list = $(containerId);
		var $listLi = $(containerId + " li:not(.placeholder)");
		$listLi.sort(function (a, b) {
			var keyA = $(a).text();
			var keyB = $(b).text();
			return (keyA > keyB) ? 1 : 0;
		});
		$.each($listLi, function (index, row) {
			$list.append(row);
		});
	}
	$(document).ready(function () {
		$(".collapsible").click(function () {
			var id = "#" + $(this).attr("data-toggle");
			$(id).toggle("clip", {}, 50);
		});
		$("#PainelTipoComida li").draggable({
			appendTo: "body",
			helper: "clone"
		});
		$("#PainelCardapios ol").droppable({
			activeClass: "ui-state-default",
			hoverClass: "ui-state-hover",
			accept: ":not(.ui-sortable-helper)",
			drop: function (event, ui) {
				var items = $(this).find("li");
				var args = ui.draggable.attr("id").split("_")
				var id = args[2];
				var cId = args[1];
				var tem = false;
				var Cardapio = $("#Cardapio_H_" + cId).text();
				var Prato = ui.draggable.text();
				items.each(function () {
					if ($(this).attr("id") == "PratoCardapio_" + cId + "_" + id) {
						tem = true;
						AvisarPratoExistente(Cardapio, Prato);
						return false;
					}
				});
				if (tem) {
					return false;
				}
				var $li = $("<li/>").text(ui.draggable.text())
					.attr("id", "PratoCardapio_" + cId + "_" + id)
					.attr("class", "list-group-item");
				var $aHref = $("<a />").text("remover")
					.attr("href", "#")
					.attr("class", "badge bg-danger")
					.appendTo($li);
				$li.appendTo(this);
				IncluirPrato(cId, id);
				SortItems($(this).attr("id"));
			}
		});
	});
</script>
<h4>Distribuição dos Pratos nos cardápios</h4>
<div id="PainelCardapios" class="col-md-6">
	@foreach (VillaBisutti.Delta.Core.Model.Cardapio c in Model.Cardapios)
	{
		<div class="panel panel-info">
			<div id="Cardapio_H_@(c.Id)" class="panel-heading collapsible" data-toggle="Cardapio_@(c.Id)">@(c.Nome)</div>
			<ol class="list-group" id="Cardapio_@(c.Id)">
				@foreach (VillaBisutti.Delta.Core.Model.Prato p in c.Pratos)
				{
					<li class="list-group-item" id="PratoCardapio_@(c.Id)_@(p.Id)">
						@(p.Nome)
						<a href="#" class="badge bg-danger">remover</a>
					</li>
				}
			</ol>
		</div>
	}
</div>
<div id="PainelTipoComida" class="col-md-6">
	@foreach (VillaBisutti.Delta.Core.Model.TipoPrato t in Model.TiposDePrato)
	{
		<div class="panel panel-info">
			<div class="panel-heading collapsible" data-toggle="Tipo_@(t.Id)">@(t.Nome)</div>
			<ol class="list-group" id="Tipo_@(t.Id)">
				@foreach (VillaBisutti.Delta.Core.Model.Prato p in t.Pratos)
				{
					<li class="list-group-item" id="PratoTipo_@(t.Id)_@(p.Id)">
						@(p.Nome)
					</li>
				}
			</ol>
		</div>
	}
</div>
